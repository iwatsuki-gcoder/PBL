#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct Process {
    int pid, at, bt, ct, wt, tat, pr, rt;
    struct Process *next;
};

struct Queue {
    struct Process *front, *rear;
};

void enqueue(struct Queue *q, struct Process *p) {
    if (!q->rear) q->front = q->rear = p;
    else {
        q->rear->next = p;
        q->rear = p;
    }
    p->next = NULL;
}

struct Process* dequeue(struct Queue *q) {
    if (!q->front) return NULL;
    struct Process *p = q->front;
    q->front = q->front->next;
    if (!q->front) q->rear = NULL;
    return p;
}

void sortByBT(struct Process *head) {
    struct Process *i, *j;
    int t;
    for (i = head; i != NULL; i = i->next)
        for (j = i->next; j != NULL; j = j->next)
            if (i->bt > j->bt) {
                t = i->pid; i->pid = j->pid; j->pid = t;
                t = i->at; i->at = j->at; j->at = t;
                t = i->bt; i->bt = j->bt; j->bt = t;
                t = i->pr; i->pr = j->pr; j->pr = t;
            }
}

void sortByPriority(struct Process *head) {
    struct Process *i, *j;
    int t;
    for (i = head; i != NULL; i = i->next)
        for (j = i->next; j != NULL; j = j->next)
            if (i->pr > j->pr) {
                t = i->pid; i->pid = j->pid; j->pid = t;
                t = i->at; i->at = j->at; j->at = t;
                t = i->bt; i->bt = j->bt; j->bt = t;
                t = i->pr; i->pr = j->pr; j->pr = t;
            }
}

void display(struct Process *p, int n) {
    float avgwt = 0, avgtat = 0;
    printf("\nPID\tAT\tBT\tPR\tWT\tTAT");
    for (int i = 0; i < n; i++, p = p->next) {
        printf("\nP%d\t%d\t%d\t%d\t%d\t%d", p->pid, p->at, p->bt, p->pr, p->wt, p->tat);
        avgwt += p->wt;
        avgtat += p->tat;
    }
    printf("\nAverage WT: %.2f", avgwt / n);
    printf("\nAverage TAT: %.2f\n", avgtat / n);
}

void fcfs(struct Process *head, int n) {
    int time = 0;
    struct Process *p = head;
    while (p) {
        if (time < p->at) time = p->at;
        time += p->bt;
        p->ct = time;
        p->tat = p->ct - p->at;
        p->wt = p->tat - p->bt;
        p = p->next;
    }
    printf("\n--- FCFS Scheduling ---\n");
    display(head, n);
}

void sjf(struct Process *head, int n) {
    sortByBT(head);
    int time = 0;
    struct Process *p = head;
    while (p) {
        if (time < p->at) time = p->at;
        time += p->bt;
        p->ct = time;
        p->tat = p->ct - p->at;
        p->wt = p->tat - p->bt;
        p = p->next;
    }
    printf("\n--- SJF Scheduling ---\n");
    display(head, n);
}

void priorityScheduling(struct Process *head, int n) {
    sortByPriority(head);
    int time = 0;
    struct Process *p = head;
    while (p) {
        if (time < p->at) time = p->at;
        time += p->bt;
        p->ct = time;
        p->tat = p->ct - p->at;
        p->wt = p->tat - p->bt;
        p = p->next;
    }
    printf("\n--- Priority Scheduling ---\n");
    display(head, n);
}

void roundRobin(struct Process *head, int n, int quantum) {
    struct Queue q = {NULL, NULL};
    struct Process *temp = head, *p;
    int time = 0, completed = 0;
    while (temp) { temp->rt = temp->bt; temp = temp->next; }
    temp = head;
    enqueue(&q, temp);
    printf("\n--- Round Robin Scheduling ---\n");
    while (completed < n) {
        p = dequeue(&q);
        if (!p) break;
        if (p->rt > quantum) {
            time += quantum;
            p->rt -= quantum;
        } else {
            time += p->rt;
            p->rt = 0;
            p->ct = time;
            p->tat = p->ct - p->at;
            p->wt = p->tat - p->bt;
            completed++;
        }
        temp = head;
        while (temp) {
            if (temp->at <= time && temp->rt > 0 && temp != p)
                enqueue(&q, temp);
            temp = temp->next;
        }
        if (p->rt > 0) enqueue(&q, p);
    }
    display(head, n);
}

int main() {
    int n, i, ch, quantum;
    struct Process *head = NULL, *temp, *p;
    printf("Enter number of processes: ");
    scanf("%d", &n);
    for (i = 0; i < n; i++) {
        p = malloc(sizeof(struct Process));
        printf("Enter AT BT PR for P%d: ", i + 1);
        scanf("%d %d %d", &p->at, &p->bt, &p->pr);
        p->pid = i + 1;
        p->next = NULL;
        if (!head) head = temp = p;
        else { temp->next = p; temp = p; }
    }
    do {
        printf("\n1.FCFS\n2.SJF\n3.Round Robin\n4.Priority\n5.Exit\nEnter choice: ");
        scanf("%d", &ch);
        if (ch == 1) fcfs(head, n);
        else if (ch == 2) sjf(head, n);
        else if (ch == 3) {
            printf("Enter Time Quantum: ");
            scanf("%d", &quantum);
            roundRobin(head, n, quantum);
        } else if (ch == 4) priorityScheduling(head, n);
    } while (ch != 5);
    return 0;
}
